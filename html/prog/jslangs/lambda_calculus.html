<html>
<head>
<link rel="stylesheet" type="text/css" href="/style.css">
<title>SKI</title>
<script type="text/javascript">
function U(I,J,O)
{
	alert=function(X){};
	q=d=0;
	function chomp()
	{
		alert("Chomp: "+I[i]);
		if(I[i]=='(')
		{
			alert("Bracketing...");
			q=i;
			d=0;
			do
			{
				if(I[i]=='(')
					d++;
				if(I[i]==')')
					d--;
				i++;
			}while(d);
			alert("Got: "+I.slice(q+1,i-1));
			return I.slice(q+1,i-1);
		}
		else
		{
			i++;
			return I.charAt(i-1);
		}
	}
	function replaceAll(str,mapObj)
	{
		return str.replace(new RegExp(Object.keys(mapObj).join("|"),"g"), function(matched)
		{
			return mapObj[matched];
		});
	}
	function toObject(names, values)
	{
		result = {};
		for(var w = 0; w < names.length; w++)
			result[names[w]] = values[w];
		return result;
	}
	O(I);
	alert("Keys: "+Object.keys(J));
	if(typeof I === "string" && I.charAt(0).match('['+Object.keys(J).join("")+']'))
	{
		s=J[I.charAt(0)];
		alert("s: "+s);
		_=[];
		i=1;
		for(n=0;n<s[0].length;n++)
			_.push(chomp());
		F=I.slice(i);
		alert("Result: "+replaceAll(s[1],toObject(s[0].split(''),_))+F);
		return replaceAll(s[1],toObject(s[0].split(''),_))+F;
	}
}
function go()
{
	Q={
		S:["XYZ","XZ(YZ)"],
		K:["XY","X"],
		I:["X","X"]
	};
	document.getElementById("out").innerHTML="";
	T=document.getElementById("in").value;
	H=setInterval(function()
	{
		T=U(T,Q,console.log);
	},100);
}
</script>
</head>
<body>
<!--#include virtual="/menu.html" -->
<h1>SKI</h1>
<textarea id="in"></textarea><br/>
<button OnClick="go();">RUN</button><br/>
<div id="out"></div><br/>
</body>
</html>