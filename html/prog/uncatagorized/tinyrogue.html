<html>
<head>
<link rel="stylesheet" type="text/css" href="/style.css">
<title>Tiny C Roguelike</title>
</head>
<body>
<!-- MENU --><iframe src="/menu.html" width="100%" height="50" frameBorder="0" scrolling="no">Your browser does not support iframes!<br/><a href="/menu.html">MENU</a></iframe>
<h1>Tiny C Roguelike</h1>
One of my passions is writing obfuscated(or just messed up) code, to do various tasks.  
When I saw <a href="http://locklessinc.com/articles/512byte_roguelike/">this</a>, 
I knew I had to try to make one of my own.  
I had a couple of problems to face:<br/>
One: I run Windows, meaning no curses, all graphics must be outputted through stdout.<br/>
Two: I want the program to be a playable game, no way to cheat<br/>
Three: No includes<br/>
Here is the code I came up with:<br/>
<pre>
<!--BEGIN-->
<pre>
#define r x[_][y]
#define p _[a+x][b+y]
#define q c[_][d]
#define G goto
#define I if
#define R rand()
#define C getch()
#define S system(&quot;cls&quot;)
#define F(x,y) for(x=0;x&lt;y;x++)
#define f F(y,h){F(x,w)
#define M(X,Y) _[c+X][d+Y]==46||_[c+X][d+Y]==37||_[c+X][d+Y]==60||_[c+X][d+Y]==62||_[c+X][d+Y]==89
main(){static int e=w;char z=R%9+1,t,a,b,x,y,c,d,j,k,_[w][h];
srand(time(0));f r=35;}F(t,120){a=R%w;b=R%h;c=R%w;d=R%h;f I(x&lt;
a&amp;&amp;x&gt;c&amp;&amp;y&lt;b&amp;&amp;y&gt;d&amp;&amp;R%10&gt;1)r=46;}}f I(r==46)G*(_[x][y-1]=60,c=x,
d=y,&amp;&amp;b);}b:x=R%w;y=R%h;I(r==46)r=z?62:(z=0,89);I(R%6)G b;l:f{
r=(R%200||r^46)?r:37;I(r==37){a=R%3-1;b=R%3-1;I(x+a==c&amp;&amp;y+b==d
)e--;I(p==46)r=p,p=37;}}}I(q==89)exit(1);I(q==62)main(e);I(q==
60&amp;&amp;e^w)return;I(R&amp;2&amp;&amp;q==37)q=46;S;f putchar((x==c&amp;&amp;y==d)?64:
r);puts(&quot;&quot;);}I(e&lt;1)exit(0);F(a,e)putchar(93);i:a=C;j=(a==97)?-
1:(a==100)?1:0;k=(a==119)?-1:(a==115)?1:0;G*(j&amp;&amp;(M(j,0)))?((c\
+=j),&amp;&amp;l):(k&amp;&amp;(M(0,k)))?((d+=k),&amp;&amp;l):&amp;&amp;i;}
</pre>
<!--END-->
</pre>
The above code will compile, but must be compiled with -Dw=... and -Dh=...
, for width and height, respectively.  Now, with some preprocessing, and indenting, we get:<br/>
<pre>
<!--BEGIN-->
int main(void)
{
	static int e=w;
	char z=rand()%9+1,t,a,b,x,y,c,d,j,k,_[w][h];
	srand(time(0));
	for(y=0;y&lt;h;y++)
	{
		for(x=0;x&lt;w;x++)
			x[_][y]=35;
	}
	for(t=0;t&lt;120;t++)
	{
		a=rand()%w;
		b=rand()%h;
		c=rand()%w;
		d=rand()%h;
		for(y=0;y&lt;h;y++)
		{
			for(x=0;x&lt;w;x++)
				if(x&lt;a&amp;&amp;x&gt;c&amp;&amp;y&lt;b&amp;&amp;y&gt;d&amp;&amp;rand()%10&gt;1)
					x[_][y]=46;
		}
	}
	for(y=0;y&lt;h;y++)
	{
		for(x=0;x&lt;w;x++)
			if(x[_][y]==46)
				goto*(_[x][y-1]=60,c=x,d=y,&amp;&amp;b);
	}
	b:
	x=rand()%w;
	y=rand()%h;
	if(x[_][y]==46)
        	x[_][y]=z?62:(z=0,89);
	if(rand()%6)
        	goto b;
	l:
	for(y=0;y&lt;h;y++)
	{
		for(x=0;x&lt;w;x++)
		{
			x[_][y]=(rand()%200||x[_][y]^46)?x[_][y]:37;
			if(x[_][y]==37)
			{
				a=rand()%3-1;
				b=rand()%3-1;
				if(x+a==c&amp;&amp;y+b==d)
					e--;
				if(_[a+x][b+y]==46)
					x[_][y]=_[a+x][b+y],_[a+x][b+y]=37;
			}
		}
	}
	if(c[_][d]==89)
		exit(1);
	if(c[_][d]==62)
		main(e);
	if(c[_][d]==60&amp;&amp;e^w)
		return;
	if(rand()&amp;2&amp;&amp;c[_][d]==37)
		c[_][d]=46;
	system(&quot;cls&quot;);
	for(y=0;y&lt;h;y++)
	{
		for(x=0;x&lt;w;x++)
            		putchar((x==c&amp;&amp;y==d)?64:x[_][y]);
		puts(&quot;&quot;);
	}
	if(e&lt;1)
        	exit(0);
	for(a=0;a&lt;e;a++)
        	putchar(93);
	i:
	a=getch();
	j=(a==97)?-1:(a==100)?1:0;
	k=(a==119)?-1:(a==115)?1:0;
	goto*(j&amp;&amp;(_[c+j][d+0]==46||_[c+j][d+0]==37||_[c+j][d+0]==60||_[c+j][d+0]==62||_[c+j][d+0]==89))?((c+=j),&amp;&amp;l):(k&amp;&amp;(_[c+0][d+k]==46||_[c+0][d+k]==37||_[c+0][d+k]==60||_[c+0][d+k]==62||_[c+0][d+k]==	89))?((d+=k),&amp;&amp;l):&amp;&amp;i;
}
<!--END-->
</pre>
Now, there are a couple of statements that are pretty out there, namely the last one.  
There is an little known feature in GCC wherein the address of a label may be taken as a void pointer, then cast back into a label!
The last statement in the program above simply uses &amp;&amp;x to turn x into a void pointer, then uses it in a ?: conditional, and casts it back.
The entire statement can be written as the following:<br/>
<pre>
<!--BEGIN-->
if(j&amp;&amp;(_[c+j][d+0]==46||_[c+j][d+0]==37||_[c+j][d+0]==60||_[c+j][d+0]==62||_[c+j][d+0]==89))
{
    c+=j;
    goto l;
}
else
    if(k&amp;&amp;(_[c+0][d+k]==46||_[c+0][d+k]==37||_[c+0][d+k]==60||_[c+0][d+k]==62||_[c+0][d+k]==89))
    {
        d+=k;
        goto l;
    }
    else
        goto i;
<!--END-->
</pre>
</body>
</html>
